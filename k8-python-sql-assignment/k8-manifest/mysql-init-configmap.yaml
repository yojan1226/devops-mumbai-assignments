apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-initdb-config
  namespace: python-sql-demo
data:
  init.sql: |
    -- Create database
    CREATE DATABASE IF NOT EXISTS studentdb;
    USE studentdb;

    -- Ensure student user exists with password
    CREATE USER IF NOT EXISTS 'student'@'%' IDENTIFIED BY 'studentpass';
    GRANT ALL PRIVILEGES ON studentdb.* TO 'student'@'%';
    FLUSH PRIVILEGES;

    -- Create students table if not exists
    CREATE TABLE IF NOT EXISTS students (
      id INT AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(50),
      email VARCHAR(50)
    );

    -- Insert initial data (ignore if already inserted)
    INSERT IGNORE INTO students (id, name, email) VALUES
      (1, 'Rohit', 'Rohit@gmail.com'),
      (2, 'Virat', 'virat@gmail.com');
